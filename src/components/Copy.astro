---
interface Props {
  text: string;
  value: string;
}

const { text, value } = Astro.props;
---

<button
  id="copy-btn"
  class="hover:text-white transition-all duration-200 line-through decoration-[#444] decoration-1 cursor-pointer"
  aria-label="Copy to clipboard"
  data-value={value}
>
  {text}
</button>

<script>
  const btn = document.getElementById('copy-btn');

  if (btn) {
    btn.addEventListener('click', async () => {
      // Prevent multiple clicks while animating
      if (btn.dataset.copying === 'true') return;

      const value = btn.dataset.value || '';
      if (!value) return;

      try {
        await navigator.clipboard.writeText(value);

        btn.dataset.copying = 'true';
        const originalText = btn.innerText;

        // 1. Transition out
        btn.style.transform = 'scale(0.95)';
        btn.style.opacity = '0';
        btn.classList.remove('line-through', 'hover:text-white', 'decoration-[#444]');

        setTimeout(() => {
          // 2. Change state (simulating a "pop" in)
          btn.innerText = 'Copied to clipboard!';
          btn.classList.add('text-green-400', 'font-medium', 'no-underline');
          btn.style.transform = 'scale(1)';
          btn.style.opacity = '1';

          // 3. Reset after delay
          setTimeout(() => {
            // Transition out "Copied"
            btn.style.transform = 'scale(0.95)';
            btn.style.opacity = '0';

            setTimeout(() => {
              // Restore original
              btn.innerText = originalText;
              btn.classList.remove('text-green-400', 'font-medium', 'no-underline');
              btn.classList.add('line-through', 'hover:text-white', 'decoration-[#444]');
              btn.style.transform = 'scale(1)';
              btn.style.opacity = '1';
              delete btn.dataset.copying;
            }, 200); // Wait for fade out
          }, 2000);
        }, 200); // Wait for initial fade out
      } catch (err) {
        console.error('Failed to copy value:', err);
      }
    });
  }
</script>
